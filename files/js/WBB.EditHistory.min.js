WBB.EditHistory={},WBB.EditHistory.Revert=Class.extend({_proxy:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),this._initButtons()},_initButtons:function(){var t=this;$(".jsPostRevert").each(function(s,e){var i=$(e);i.click($.proxy(t._click,t))})},_click:function(t){var s=$(t.currentTarget).data("versionID");this._proxy.setOption("data",{actionName:"revert",className:"wbb\\data\\post\\history\\version\\PostHistoryVersionAction",objectIDs:[s]}),this._proxy.sendRequest()},_success:function(){location.reload();var t=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));t.show()}}),WBB.EditHistory.IPAddressHandler=Class.extend({_cache:{},_dialog:null,_proxy:null,init:function(){this._cache={},this._dialog=null,this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),this._initButtons(),WCF.DOMNodeInsertedHandler.addCallback("WBB.EditHistory.IPAddressHandler",$.proxy(this._initButtons,this))},_initButtons:function(){var t=this;$(".jsIpAddress").each(function(s,e){var i=$(e),o=i.data("versionID");void 0===t._cache[o]&&(t._cache[o]="",i.click($.proxy(t._click,t)))})},_click:function(t){var s=$(t.currentTarget).data("versionID");this._cache[s]?this._showDialog(s):(this._proxy.setOption("data",{actionName:"getIpLog",className:"wbb\\data\\post\\history\\version\\PostHistoryVersionAction",parameters:{versionID:s}}),this._proxy.sendRequest())},_success:function(t){this._cache[t.returnValues.versionID]=t.returnValues.template,this._showDialog(t.returnValues.versionID)},_showDialog:function(t){null===this._dialog&&(this._dialog=$('<div id="wbbIpAddressLog" />').hide().appendTo(document.body)),this._dialog.html(this._cache[t]),this._dialog.wcfDialog({title:WCF.Language.get("wbb.post.ipAddress.title")}),this._dialog.wcfDialog("render")}}),WBB.EditHistory.CompareHandler=Class.extend({_cache:{},_dialog:null,_proxy:null,_cversion1:0,_cversion2:0,_postID:0,init:function(t){this._postID=t,this._cache={},this._dialog=null,this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),this._initButtons(),WCF.DOMNodeInsertedHandler.addCallback("WBB.EditHistory.CompareHandler",$.proxy(this._initButtons,this)),new WCF.Action.Proxy({autoSend:!0,data:{actionName:"getMarkedVersions",className:"wbb\\data\\post\\history\\version\\PostHistoryVersionAction",parameters:{postID:this._postID}},success:$.proxy(this._loadMarkedVersionsSuccess,this)}),$('<div id="showQuotes" class="balloonTooltip" />').click($.proxy(this._compare,this)).text(WCF.Language.get("wbb.post.edithistory.compare")).appendTo(document.body).show()},_compare:function(){void 0!=this._cache[this._createuid(this._cversion1,this._cversion2)]?this._showDialog(this._createuid(this._cversion1,this._cversion2)):(this._proxy.setOption("data",{actionName:"compare",className:"wbb\\data\\post\\history\\version\\PostHistoryVersionAction",parameters:{version1:this._cversion1,version2:this._cversion2}}),this._proxy.sendRequest())},_initButtons:function(){var t=this;$(".firstVersionCompare").each(function(s,e){var i=$(e);i.change(function(){t._cversion1=$(this).data("objectId"),t._regenerateOptions(!0)})}),$(".secondVersionCompare").each(function(s,e){var i=$(e);i.change(function(){t._cversion2=$(this).data("objectId"),t._regenerateOptions(!0)})})},_loadMarkedVersionsSuccess:function(t){0!==t.returnValues.one&&0!==t.returnValues.second?(this._cversion1=t.returnValues.one,this._cversion2=t.returnValues.second,$("#radioButtonVersionOne"+this._cversion1).attr("checked","checked"),$("#radioButtonVersionSecond"+this._cversion2).attr("checked","checked"),this._regenerateOptions(!1)):($(".firstVersionCompare").first().attr("checked","checked"),$(".secondVersionCompare").last().attr("checked","checked"),this._cversion1=$(".firstVersionCompare").first().data("objectId"),this._cversion2=$(".secondVersionCompare").last().data("objectId"),this._regenerateOptions(!0))},_saveMarkedVersions:function(){new WCF.Action.Proxy({autoSend:!0,data:{actionName:"markVersions",className:"wbb\\data\\post\\history\\version\\PostHistoryVersionAction",parameters:{version1:this._cversion1,version2:this._cversion2}}})},_regenerateOptions:function(t){var s=this;$(".secondVersionCompare").each(function(t,e){$(e);$(e).data("objectId")>=s._cversion1?$(e).prop("disabled",!0):$(e).prop("disabled",!1)}),$(".firstVersionCompare").each(function(t,e){$(e);$(e).data("objectId")<=s._cversion2?$(e).prop("disabled",!0):$(e).prop("disabled",!1)}),t===!0&&this._saveMarkedVersions()},_createuid:function(t,s){return t+"y"+s},_success:function(t){this._cache[t.returnValues.uid]=t.returnValues.template,this._showDialog(t.returnValues.uid)},_showDialog:function(t){null===this._dialog&&(this._dialog=$('<div id="wbbEditHistoryCompare" />').hide().appendTo(document.body)),this._dialog.html(this._cache[t]),this._dialog.wcfDialog({title:WCF.Language.get("wbb.post.edithistory.comparison")}),this._dialog.wcfDialog("render")}});
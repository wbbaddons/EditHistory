WBB.EditHistory={};WBB.EditHistory.Revert=Class.extend({_proxy:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._initButtons()},_initButtons:function(){var e=this;$(".jsPostRevert").each(function(t,n){var r=$(n);r.click($.proxy(e._click,e))})},_click:function(e){var t=$(e.currentTarget).data("versionID");this._proxy.setOption("data",{actionName:"revert",className:"wbb\\data\\post\\history\\version\\PostHistoryVersionAction",objectIDs:[t]});this._proxy.sendRequest()},_success:function(e,t,n){location.reload();var r=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));r.show()}});WBB.EditHistory.IPAddressHandler=Class.extend({_cache:{},_dialog:null,_proxy:null,init:function(){this._cache={};this._dialog=null;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._initButtons();WCF.DOMNodeInsertedHandler.addCallback("WBB.EditHistory.IPAddressHandler",$.proxy(this._initButtons,this))},_initButtons:function(){var e=this;$(".jsIpAddress").each(function(t,n){var r=$(n);var i=r.data("versionID");if(e._cache[i]===undefined){e._cache[i]="";r.click($.proxy(e._click,e))}})},_click:function(e){var t=$(e.currentTarget).data("versionID");if(this._cache[t]){this._showDialog(t)}else{this._proxy.setOption("data",{actionName:"getIpLog",className:"wbb\\data\\post\\history\\version\\PostHistoryVersionAction",parameters:{versionID:t}});this._proxy.sendRequest()}},_success:function(e,t,n){this._cache[e.returnValues.versionID]=e.returnValues.template;this._showDialog(e.returnValues.versionID)},_showDialog:function(e){if(this._dialog===null){this._dialog=$('<div id="wbbIpAddressLog" />').hide().appendTo(document.body)}this._dialog.html(this._cache[e]);this._dialog.wcfDialog({title:WCF.Language.get("wbb.post.ipAddress.title")});this._dialog.wcfDialog("render")}});WBB.EditHistory.CompareHandler=Class.extend({_cache:{},_dialog:null,_proxy:null,_cversion1:0,_cversion2:0,_postID:0,init:function(e){this._postID=e;this._cache={};this._dialog=null;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._initButtons();WCF.DOMNodeInsertedHandler.addCallback("WBB.EditHistory.CompareHandler",$.proxy(this._initButtons,this));new WCF.Action.Proxy({autoSend:true,data:{actionName:"getMarkedVersions",className:"wbb\\data\\post\\history\\version\\PostHistoryVersionAction",parameters:{postID:this._postID}},success:$.proxy(this._loadMarkedVersionsSuccess,this)})},_compare:function(){if(this._cache[this._createuid(this._cversion1,this._cversion2)]!=undefined){this._showDialog(this._createuid(this._cversion1,this._cversion2))}else{this._proxy.setOption("data",{actionName:"compare",className:"wbb\\data\\post\\history\\version\\PostHistoryVersionAction",parameters:{version1:this._cversion1,version2:this._cversion2}});this._proxy.sendRequest()}},_initButtons:function(){$('<div id="showQuotes" class="balloonTooltip" />').click($.proxy(this._compare,this)).text(WCF.Language.get("wbb.post.edithistory.compare")).appendTo(document.body).show();var e=this;$(".firstVersionCompare").each(function(t,n){var r=$(n);r.change(function(){e._cversion1=$(this).data("objectId");e._regenerateOptions(true)})});$(".secondVersionCompare").each(function(t,n){var r=$(n);r.change(function(){e._cversion2=$(this).data("objectId");e._regenerateOptions(true)})})},_loadMarkedVersionsSuccess:function(e,t,n){if(e.returnValues.one!==0&&e.returnValues.second!==0){this._cversion1=e.returnValues.one;this._cversion2=e.returnValues.second;$("#radioButtonVersionOne"+this._cversion1).attr("checked","checked");$("#radioButtonVersionSecond"+this._cversion2).attr("checked","checked");this._regenerateOptions(false)}else{$(".firstVersionCompare").first().attr("checked","checked");$(".secondVersionCompare").last().attr("checked","checked");this._cversion1=$(".firstVersionCompare").first().data("objectId");this._cversion2=$(".secondVersionCompare").last().data("objectId");this._regenerateOptions(true)}},_saveMarkedVersions:function(){new WCF.Action.Proxy({autoSend:true,data:{actionName:"markVersions",className:"wbb\\data\\post\\history\\version\\PostHistoryVersionAction",parameters:{version1:this._cversion1,version2:this._cversion2}}})},_regenerateOptions:function(e){var t=this;$(".secondVersionCompare").each(function(e,n){var r=$(n);if($(n).data("objectId")>=t._cversion1){$(n).prop("disabled",true)}else{$(n).prop("disabled",false)}});$(".firstVersionCompare").each(function(e,n){var r=$(n);if($(n).data("objectId")<=t._cversion2){$(n).prop("disabled",true)}else{$(n).prop("disabled",false)}});if(e===true){this._saveMarkedVersions()}},_createuid:function(e,t){return e+"y"+t},_success:function(e,t,n){this._cache[e.returnValues.uid]=e.returnValues.template;this._showDialog(e.returnValues.uid)},_showDialog:function(e){if(this._dialog===null){this._dialog=$('<div id="wbbEditHistoryCompare" />').hide().appendTo(document.body)}this._dialog.html(this._cache[e]);this._dialog.wcfDialog({title:WCF.Language.get("wbb.post.edithistory.comparison")});this._dialog.wcfDialog("render")}})